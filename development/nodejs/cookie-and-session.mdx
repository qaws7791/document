# 쿠키와 세션

HTTP는 상태가 없는 프로토콜입니다. (Stateless)

하지만 웹에서는 상태를 기억하고 저장해야 할 일이 있습니다. 로그인 또는, 익명 채팅방 같은 비로그인 방식에서의 사용자 인증 그리고 사용자의 탐색 기록, 최근 본 상품, 장바구니 등 사용자 관련된 정보부터 사용자 경험을 위해 동선을 추적하고 개인화된 추천 시스템을 만들기 위한 데이터 수집 용도로도 사용됩니다.


## 쿠키

쿠키는 데이터를 저장하는 방법으로, 사용자의 브라우저에 저장됩니다.

최대 크기는 **4KB**로 제한되고, **문자열 데이터**만 저장할 수 있습니다

사용자는 브라우저에서 쿠키의 내용을 볼 수 있습니다.

사용자는 쿠키를 삭제하거나 금지할 수 있습니다.

쿠키는 클라이언트로부터 오기 때문에 **항상 변조의 위험**이 있습니다.

처음부터 **서명(Sign)된** 쿠키를 사용하여 변조 시 알아챌 수 있도록 해야 합니다

쿠키는 자바스크립트로 조작이 가능하므로 **XSS 공격**으로 인해 변경될 위험이 있습니다

`httponly`로 설정하여 서버측에서만 조작이 가능하도록 할 수 있습니다

- `domain`: 쿠키가 유효한 도메인을 지정합니다. 기본값은 현재 도메인입니다.

- `path`: 쿠키가 적용될 경로를 지정합니다. 기본값은 `/`으로 전체 경로에 적용됩니다.

- `maxAge`: 쿠키의 만료 시간을 밀리초 단위로 지정합니다. 만료 시간이 지나면 쿠키가 삭제됩니다. 지정하지 않으면 브라우저가 닫힐 때 삭제됩니다. `expires`와 `maxAge` 중 하나만 지정해야 합니다.
  만약 둘 다 지정하면 `maxAge`를 우선합니다.

- `secure`: HTTPS 프로토콜에서만 쿠키가 전송됩니다. 기본값은 `false`입니다.

- `httpOnly`: 클라이언트에서 쿠키를 조작할 수 없도록 합니다. 기본값은 `false`입니다. 이 방법은 XSS 공격을 방지하는데 도움이 됩니다.

- `signed`: 쿠키를 서명하여 변조를 방지합니다. 서명된 쿠키는 `req.signedCookies` 객체에 저장됩니다. 기본값은 `false`입니다. 서명된 쿠키가 변조되면 서버에서 에러가 발생합니다.


## 세션

일반적으로 상태를 유지하는 가장 좋은 방법은 세션입니다. 세션은 사용자의 정보를 서버에 저장하는 방법입니다. 세션은 일반적으로 쿠키를 사용하여 세션 ID를 클라이언트 측에 저장하고, 서버에서 세션 ID를 통해 사용자의 정보를 유지합니다. 정보를 서버에 저장하기 때문에 쿠키에 정보를 저장하는 방법보다 안전한 것으로 여겨집니다. 세션은 사용자가 로그아웃 또는 브라우저 창을 받을 때 종료됩니다. 세션은 서버에 저장되기 때문에 저장할 수 있는 데이터의 형식이나 크기의 제한에서 상대적으로 자유롭습니다


### 세션 구현 방법

두 가지 방법 모두 결론적으로 쿠키에 사용자 식별을 위한 값을 저장해야 하기 때문에 쿠키에 의존하고 있습니다

1. 사용자 정보를 쿠키에 저장하는 방법
2. 세션 ID만 쿠키에 저장하고 서버에서 사용자 정보를 유지하는 방법


### 세션 저장 방법

1. 메모리에 저장 - 가장 쉬운 방법이지만 서버가 종료되면 세션 정보가 사라지고, 서버가 여러 대일 경우 서버 간 세션 정보가 다를 수 있습니다
2. 데이터베이스에 저장 - 데이터베이스에 저장하면 서버가 종료되어도 세션 정보가 유지되고, 서버 간 세션 정보가 같습니다.
3. 파일에 저장 -  파일에 저장하는 방법은 파일 시스템에 부하를 줄 수 있습니다.

