# 메모리

## 메모리란

**메모리(Memory)**는 컴퓨터에서 데이터를 일시적으로 저장하고 접근하는 장치를 의미합니다. 프로그램이 실행되는 동안 필요한 데이터와 명령어를 저장하여 CPU가 빠르게 접근할 수 있도록 합니다.

**기억장치(Storage Device)**는 데이터를 영구적으로 저장하는 장치를 말합니다. 전원이 꺼져도 데이터가 유지되며, 하드 디스크 드라이브(HDD), 솔리드 스테이트 드라이브(SSD) 등이 이에 속합니다.



## 메모리의 종류와 특징

### 주기억장치(Main Memory)

주기억장치는 CPU가 직접 접근하여 데이터를 읽고 쓸 수 있는 메모리로, **램(RAM)**이 대표적입니다.

### 램(RAM: Random Access Memory)

- 휘발성 메모리로 전원이 꺼지면 데이터가 사라집니다.
- 임의 접근이 가능하여 빠른 속도로 데이터 읽기/쓰기가 가능합니다.
- **동적 메모리 DRAM(Dynamic RAM)**: 주기적으로 재충전(refresh)이 필요하며, 고밀도로 저장 가능하여 주로 메인 메모리로 사용됩니다.
- **정적 메모리 SRAM(Static RAM)**: 재충전이 필요 없으며, DRAM보다 빠르지만 비용이 높아 주로 CPU 캐시 메모리로 사용됩니다.

### 보조기억장치(Secondary Storage)

- 보조기억장치는 대용량의 데이터를 영구적으로 저장하기 위한 장치입니다.
- 
- **하드 디스크 드라이브(HDD)**
  - 자기 디스크를 회전시켜 데이터를 읽고 씁니다.
  - 용량 대비 가격이 저렴하지만, 기계적인 움직임으로 인한 속도 한계와 소음이 심하며, 충격에 약하다.
- **솔리드 스테이트 드라이브(SSD)**
  - 플래시 메모리를 사용하여 기계적 움직임 없이 데이터를 저장합니다.
  - 빠른 속도와 내구성을 제공하지만, HDD에 비해 가격이 높습니다.
- 그 외의 보조기억장치들: 플로피 디스크, CD ROM, DVD, Blu-ray, 플래시 메모리, 자기 테이프 등

### 캐시 메모리(Cache Memory)

- CPU와 메인 메모리 사이의 속도 차이를 보완하기 위한 고속 메모리입니다.
- 자주 사용하는 데이터를 저장하여 CPU의 접근 시간을 단축합니다.
- **L1 캐시**: CPU 코어 내부에 위치하며 가장 빠르고 용량이 적다. 일반적으로 CPU 작업 정보를 저장하는 명령 캐시와 작업 데이터를 저장하는 데이터 캐시로 구성된다.
- **L2 캐시**: L1 캐시보다 용량이 크며 약간 느리지만 여전히 시스템 RAM보다는 훨씬 빠르다
- **L3 캐시**: 여러 코어가 공유하며 가장 용량이 크고 상대적으로 느립니다.



## 메모리의 작동 원리와 관리 기법

### 메모리의 작동 원리

- CPU는 프로그램 실행 시 필요한 데이터와 명령어를 메모리에서 가져옵니다.
- 메모리는 주소(Address)를 통해 데이터를 저장하고 접근합니다.
- 프로그램이 실행될 때 운영체제는 프로세스에게 메모리 공간을 할당합니다.

### 메모리 배치 전략

- **연속 배치(Contiguous Allocation)**: 프로세스에 연속된 메모리 공간을 할당합니다.
- **불연속 배치(Non-contiguous Allocation)**: 프로세스에 비연속적인 메모리 블록을 할당하여 단편화를 줄입니다.

### 가상 메모리(Virtual Memory)

- 실제 메모리보다 큰 메모리 공간을 제공하기 위한 기법으로, 보조기억장치를 이용합니다.
- **페이지 교체 알고리즘**을 통해 필요한 메모리 페이지를 메모리에 적재합니다.

### 페이지 메모리 관리

- 메모리를 동일한 크기의 블록인 **페이지(Page)**로 나누어 관리합니다.
- **페이지 테이블**을 사용하여 가상 주소와 실제 물리적 주소를 매핑합니다.



## 메모리 할당 방식

### 연속할당 방식

메모리에 연속적으로 공간을 할당

#### 고정 분할 방식

메모리를 미리 특정 크기로 나누어 관리하는 방식

내부 단편화 발생 (메모리가 커서할당되고 남은 공간이낭비)

#### 가변 분할 방식

매 시점 프로그램의 크기에 맞게 동적으로 메모리를 나눠 사용하는 방식

1. 최초 적합: 처음 보이는 공간에 먼저 할당
2. 최적 적합: 가장 크기에 맞는 공간에 먼저 할당
3. 최악 적합: 가장 크기가 큰 공간에 먼저 할당

외부 단편화 발생 (메모리가 작아 할당되지 못해 공간이 낭비)



### 불연속 할당 방식

여러 작업을 효율적으로 수행하기 위해 사용

{% hint style="warning" %}
메모리 공간 할당과 해제 시 오버헤드 발생

메모리 공간이 분상되어 프로세스가 불연속 공간에 할당 시 페이지 교체 같은 작업의 복잡성 증가
{% endhint %}

1. **Linked List**: 불연속 공간에 프로세스를 할당할 때, **할당된 공간의 주소를 연결리스트에 저장**하는 방식입니다. 이 방식은 메모리 할당과 해제가 빠르지만, 공간 낭비가 발생할 수 있음
2. **Bitmap**: **메모리 공간의 각 블록을 0 또는 1로 표시**하여 사용 가능한 블록과 사용 중인 블록을 구분하는 방식입니다. 이 방식은 링크드 리스트보다 효율적인 공간 관리를 제공하지만, 메모리 크기가 큰 경우 비트맵이 매우 커지는 단점이 있습니다.
3. **Page Table**: 가상 메모리 시스템에서 사용되는 방식으로, 물리적인 주소 공간을 페이지라는 작은 블록으로 나누어 사용합니다. 각 프로세스는 자신의 페이지 테이블을 가지며, 페이지 테이블은 물리적인 주소와 가상 주소를 매핑하는 역할을 합니다. 이 방식은 링크드 리스트와 비트맵보다 효율적이며, 가상 메모리를 구현하는 데 필요한 기술\



#### 페이징(Paging)

* **동일한 크기의 페이지 단위** 나누어 메모리의 서로 다른 위치에 프로세스를 할당
* 빈데이터(홀)의 크기가 균일하지 않은 문제가 없어지지만 주소 변환이 복잡

#### 세그먼테이션(Segmentation)

* 코드,  데이터, 함수 등 의미 단위 세그먼트로 나눔
* 빈데이터(홀) 크기가 균일하지 않는 문제 발생

#### 페이지드 세그먼테이션(Paged Segmentation)

* 공유나 보안은 세그먼트, 물리적 메모리는 페이지로 나누는 방식



### 페이지 교체 알고리즘

페이지 부재로 인해새로운 페이지를 적재할 때 메모리에 저장된 페이지 중 어떤 페이지를 교체할지 결정하는 알고리즘

#### 시간 기반 알고리즘

1. FIFO(First In First Out): 가장 먼저 들어온 페이지를 교체\
   오래된 데이터가 최근에 사용된 데이터와 비슷하면 성능 저하
2. LRU(Least Recently Used): 참조가 가장 오래된 페이지를 교체\
   페이지를 사용할 때마다 사용 시간을 갱신\
   추가적으로계수기, 스택이 필요
3. NUR(Not Used Recently): 참조 비트와 변경 비트를 사용하여 가장 낮은 우선순위의 페이지를 교체

#### 빈도 기반 알고리즘

1. LFU(Least Frequently Used): 가장 참조 횟수가 적은 페이지를 교체\
   일부 데이터가 빈번하게 사용되면 성능 저하



## **메모리 계층 구조(Memory Hierarchy)**

- 다양한 속도와 용량의 메모리를 계층적으로 배치하여 비용 효율성과 성능을 최적화합니다.
- 응답 시간을 기준으로 계층을 분리한다(상위 계층은 빠르지만 용량이 적고, 하위 계층은 느리지만 용량이 큽니다.)

![Computer Memory Hierarchy](assets/ComputerMemoryHierarchy.svg.png)

### 계층 구조의 구성

1. **레지스터(Register)**: CPU 내부에 있는 가장 빠른 메모리입니다.
2. **캐시 메모리(Cache Memory)**: CPU 근처에 위치하여 빠른 데이터 접근을 제공합니다.
3. **주기억장치(Main Memory)**: 램으로 구성되며, 프로그램 실행에 필요한 데이터를 저장합니다.
4. **보조기억장치(Secondary Storage)**: HDD, SSD 등으로 대용량 데이터 저장을 담당합니다.
5. **근거리 저장소(Nearline Storage)**: 온라인 저장소와 오프라인 저장소 사이의 절충안.
6. **오프라인 저장장치(Offline Storage)**: 테이프, 광디스크 등으로 데이터 백업에 사용됩니다.

### 저장소의 구분

- 온라인 스토리지는 입출력(I/O)을 위해 즉시 사용할 수 있다.
- 근거리 저장은 즉시 사용할 수 없지만, 인간의 개입 없이 신속하게 온라인으로 만들 수 있다.
- 오프라인 저장소는 즉시 사용할 수 없으며 온라인 상태로 전환하려면 인간의 개입이 필요하다.



## 입출력 성능 향상을 위한 기술

### 버퍼링(Buffering)

- 데이터 입출력 시 버퍼를 사용하여 속도 차이를 보완합니다.
- 버퍼는 메모리의 한 영역으로, 입출력 장치와의 데이터 교환을 효율적으로 관리합니다.

### 스풀링(Spooling)

- 인쇄 작업 등에서 여러 작업을 디스크에 임시 저장한 후 순차적으로 처리합니다.
- CPU와 입출력 장치의 작업을 병렬로 수행하여 효율을 높입니다.

### 채널 제어기(Channel Controller)

- 대형 시스템에서 입출력 작업을 전담하는 프로세서로, CPU의 부담을 줄입니다.

